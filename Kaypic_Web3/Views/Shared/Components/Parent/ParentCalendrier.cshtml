@using System.Globalization
@model IEnumerable<Kaypic_Web3.Models.Calendrier>
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor;
@{
    Layout = null;
    var idUtilisateur = HttpContextAccessor.HttpContext.Session.GetInt32("UtilisateurID");
}
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f5f6fa;
        color: #333;
    }

    /* Header */
    header {
        background-color: #0d47ff;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
    }

    /* Layout */
    .container {
        display: flex;
        width: 100%;
        min-height: calc(100vh - 60px);
    }

    /* Sidebar */
    aside {
        width: 250px;
        background: #f8f9fb;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }

    /* Navigation dans aside */
    nav {
        display: flex;
        flex-direction: column;
        border-bottom: 1px solid #ddd;
    }

        nav a {
            padding: 12px 20px;
            text-decoration: none;
            color: #333;
            border-left: 3px solid transparent;
        }

            nav a.active {
                background: #fff;
                border-left: 3px solid #0d47ff;
                font-weight: bold;
                color: #0d47ff;
            }

            nav a:hover {
                background: #eee;
            }

    /* Filtres */
    .filters {
        padding: 20px;
    }

        .filters h3 {
            font-size: 14px;
            margin-bottom: 15px;
        }

        .filters label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
        }

    /* Main */
    main {
        flex: 1;
        padding: 20px;
        box-sizing: border-box;
    }

    .main-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: black;
        color: white;
        padding: 20px;
        border-radius: 5px;
        margin-bottom: 20px;
    }

        .main-header h2 {
            margin: 0;
        }

    .btn {
        background: #0d47ff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
    }

    /* Sections */
    section {
        margin-bottom: 25px;
    }

        section h3 {
            margin-bottom: 15px;
            font-size: 16px;
            color: #0d47ff;
        }

    /* Cards */
    .card {
        background: #fff;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid transparent;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

        .card.pinned {
            background: #eef5ff;
            border-left: 4px solid #0d47ff;
        }

        .card .title {
            font-weight: bold;
            margin-bottom: 8px;
        }

    .badge {
        display: inline-block;
        font-size: 12px;
        padding: 3px 7px;
        border-radius: 5px;
        margin-left: 5px;
    }

    .urgent {
        background: #ffebee;
        color: #d32f2f;
    }

    .important {
        background: #fff8e1;
        color: #f9a825;
    }

    .meta {
        font-size: 12px;
        color: #666;
        margin-top: 8px;
    }

    .btn-mini {
        background: #0d47ff;
        color: white;
        border: none;
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 4px;
        cursor: pointer;
    }

        .btn-mini:hover {
            background: #0836cc;
        }

    #btnSupprimer {
        background: #FF0000;
    }

        #btnSupprimer:hover {
            background: #cc0000;
        }
</style>
@functions {
    public string GetEventClass(Kaypic_Web3.Models.Type eventType)
    {
        var mapping = new Dictionary<Kaypic_Web3.Models.Type, string>
        {
            [Kaypic_Web3.Models.Type.Match] = "match",
            [Kaypic_Web3.Models.Type.Entrainement] = "training",
            [Kaypic_Web3.Models.Type.Réunion] = "meeting"
        };

        return mapping.GetValueOrDefault(eventType, "other");
    }

    public string GetEventType(Kaypic_Web3.Models.Type eventType)
    {
        var mapping = new Dictionary<Kaypic_Web3.Models.Type, string>
        {
            [Kaypic_Web3.Models.Type.Match] = "match",
            [Kaypic_Web3.Models.Type.Entrainement] = "entrainement",
            [Kaypic_Web3.Models.Type.Réunion] = "reunion"
        };

        return mapping.GetValueOrDefault(eventType, "other");
    }
}

<section>
    <div class="main-header">
        <h2>Mes Événements</h2>
        <a asp-controller="Calendriers" asp-action="Create"> <button class="btn">+ Ajouter un événement</button> </a>
    </div>

    <div class="card training">
        @foreach (var e in Model)
        {
            <div class="card @GetEventClass(e.type)" data-event-type="@GetEventType(e.type)">
                <div class="title">@e.type - @e.Equipe.Nom</div>
                @{
                    var dateEvenement = e.Date;
                    CultureInfo frenchCulture = new CultureInfo("fr-FR");
                    string dateInFrench = dateEvenement.ToString("D", frenchCulture);
                    var heureInFrench = e.Heure?.ToString(@"hh\:mm");
                }
                <div class="meta">Le @dateInFrench | @heureInFrench | @e.Lieu</div>
                @if (@e.Utilisateurid == idUtilisateur)
                {
                    <a asp-controller="Calendriers" asp-route-id="@e.Id" asp-action="Edit">
                        <button class="btn-mini">Modifier</button>
                    </a>
                    <a asp-controller="Calendriers" asp-route-id="@e.Id" asp-action="Delete">
                        <button class="btn-mini" id="btnSupprimer">Supprimer</button>
                    </a>
                }
            </div>
        }
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function applyFilters() {
            // cocher par défaut
            const defaultFilters = {
                "match": true,
                "entrainement": true,
                "reunion": true
            };

            const filters = JSON.parse(localStorage.getItem('calendarFilters') || JSON.stringify(defaultFilters));
            const eventCards = document.querySelectorAll('[data-event-type]');

            eventCards.forEach(card => {
                const eventType = card.dataset.eventType;
                if (filters[eventType] !== false) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        applyFilters();

        window.addEventListener('storage', function(e) {
            if (e.key === 'calendarFilters') {
                applyFilters();
            }
        });

        // voir si les filtres change périodiquement
        setInterval(applyFilters, 100);
    });
</script>